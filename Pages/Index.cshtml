@page
@model Assistant.Pages.IndexModel
@{
    ViewData["Title"] = "Clients";
}

<div class="clients-stage">
    <div class="clients-surface">
        <div class="clients-toolbar">
            <div class="clients-heading">
                <h3 class="clients-title">Мои клиенты</h3>
                <p class="clients-subtitle">Локальный список клиентов, к которым у вас есть доступ.</p>
            </div>

            <div class="clients-actions">
                <label class="clients-search" aria-label="Фильтр по клиентам">
                    <svg xmlns="http://www.w3.org/2000/svg" class="clients-search__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="m21 21-4.3-4.3" />
                    </svg>
                    <input id="clientFilter" placeholder="Search clients..." class="clients-search__input" />
                </label>

                <a asp-page="/Clients/Create" class="btn-primary clients-create">
                    Создать клиента
                </a>
            </div>
        </div>

        @if (User.IsInRole("assistant-admin"))
        {
            <div class="clients-info clients-info--muted">
                Используйте пункт «Поиск клиентов» в панели слева, чтобы найти клиентов во всех реалмах.
            </div>
        }

        <div id="clientsContainer">
            @await Html.PartialAsync("_ClientsList", Model)
        </div>
    </div>
</div>

<script data-soft-nav>
    (() => {
        const input = document.getElementById('clientFilter');
        const container = document.getElementById('clientsContainer');
        if (!input || !container) return;

        const applyFilter = () => {
            const q = input.value.trim().toLowerCase();
            const cards = container.querySelectorAll('.client-card');
            cards.forEach(c => {
                const hay = (c.dataset.search || '').toLowerCase();
                const match = !q || hay.includes(q);
                c.classList.toggle('hidden', !match);
            });
        };

        input.addEventListener('input', applyFilter);
        applyFilter();
    })();
</script>

@section Toasts {
    @if (TempData["FlashOk"] is string flash)
    {
        <div class="kc-toast kc-toast-success" id="flashToast" role="alert">
            <div class="kc-toast-icon">✓</div>
            <div class="kc-toast-body">
                <div class="kc-toast-title">@flash</div>
            </div>
            <button type="button" class="kc-toast-close" aria-label="Закрыть"
                    onclick="this.closest('.kc-toast').remove()">×</button>
        </div>
        <script data-soft-nav>setTimeout(() => document.getElementById('flashToast')?.remove(), 10000);</script>
    }
}
