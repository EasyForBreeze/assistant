@page
@using Assistant.Pages.Shared
@model Assistant.Pages.Clients.SearchModel
@{
    ViewData["Title"] = "Поиск клиентов";
}

@{
    Func<dynamic, Microsoft.AspNetCore.Html.IHtmlContent> searchHeaderRight = @<text>
        <form method="get" class="flex items-center gap-3 w-full md:w-auto"
              data-soft-transition="#clientsResults">
            @await Html.PartialAsync("_SearchInput", new SearchInputModel
            {
                Name = "q",
                Value = Model.Q,
                Placeholder = "Ищем по всем реалмам...",
                WidthClasses = "w-full md:w-[320px]"
            })
            <button type="submit" class="btn-primary whitespace-nowrap">Найти</button>
        </form>
        <a asp-page="/Clients/Create" class="btn-primary whitespace-nowrap">
            Создать клиента
        </a>
    </text>;
}
@await Html.PartialAsync("_AuroraHeader", new AuroraHeaderModel
{
    Title = "Поиск клиентов",
    HeadingTag = "h3",
    ThemeClass = "aurora-green-indigo",
    ContentClasses = "relative flex flex-col gap-4 md:flex-row md:items-center md:justify-between",
    TitleCssClass = "text-3xl md:text-4xl text-white tracking-tight drop-shadow-[0_6px_18px_rgba(99,102,241,0.25)]",
    Subtitle = "Выполните поиск по всем реалмам Keycloak. Результаты отфильтруются по введённому clientId.",
    SubtitleCssClass = "text-slate-200/80 mt-2 text-sm max-w-xl",
    RightContent = searchHeaderRight,
    RightContainerClasses = "flex items-center gap-3 w-full md:w-auto"
})

<div id="clientsResults" class="space-y-5">
    @if (string.IsNullOrEmpty(Model.Q))
    {
        <div class="kc-card p-5 text-sm text-slate-300/90">
            Введите идентификатор клиента, чтобы получить результаты поиска по всем доступным реалмам.
        </div>
    }

    <div id="clientsContainer">
        @await Html.PartialAsync("_ClientsList", Model)
    </div>
</div>

@section Toasts {
    @if (TempData["FlashOk"] is string flash)
    {
        @await Html.PartialAsync("_FlashToast", new FlashToastModel
        {
            Type = FlashToastType.Success,
            MessageHtml = Html.Raw(flash),
            Id = "flashToast"
        })
    }
}
