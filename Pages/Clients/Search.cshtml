@page
@model Assistant.Pages.Clients.SearchModel
@{
    ViewData["Title"] = "Поиск клиентов";
}

@{
    Func<dynamic, Microsoft.AspNetCore.Html.IHtmlContent> searchHeaderRight = @<text>
        <form method="get" class="flex items-center gap-3 w-full md:w-auto"
              data-soft-transition="#clientsResults">
            <div class="flex items-center gap-2 kc-input rounded-xl px-3 py-2 text-sm w-full md:w-[320px] focus-within:border-white/20">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                </svg>
                <input name="q" value="@Model.Q" placeholder="Ищем по всем реалмам..."
                       class="bg-transparent outline-none placeholder:text-slate-400 w-full" />
            </div>
            <button type="submit" class="btn-primary whitespace-nowrap">Найти</button>
        </form>
        <a asp-page="/Clients/Create" class="btn-primary whitespace-nowrap">
            Создать клиента
        </a>
    </text>;
}
@await Html.PartialAsync("_AuroraHeader", new AuroraHeaderModel
{
    Title = "Поиск клиентов",
    HeadingTag = "h3",
    ThemeClass = "aurora-green-indigo",
    ContentClasses = "relative flex flex-col gap-4 md:flex-row md:items-center md:justify-between",
    TitleCssClass = "text-3xl md:text-4xl text-white tracking-tight drop-shadow-[0_6px_18px_rgba(99,102,241,0.25)]",
    Subtitle = "Выполните поиск по всем реалмам Keycloak. Результаты отфильтруются по введённому clientId.",
    SubtitleCssClass = "text-slate-200/80 mt-2 text-sm max-w-xl",
    RightContent = searchHeaderRight,
    RightContainerClasses = "flex items-center gap-3 w-full md:w-auto"
})

<div id="clientsResults" class="space-y-5">
    @if (string.IsNullOrEmpty(Model.Q))
    {
        <div class="kc-card p-5 text-sm text-slate-300/90">
            Введите идентификатор клиента, чтобы получить результаты поиска по всем доступным реалмам.
        </div>
    }

    <div id="clientsContainer">
        @await Html.PartialAsync("_ClientsList", Model)
    </div>
</div>

@section Toasts {
    @if (TempData["FlashOk"] is string flash)
    {
        <div class="kc-toast kc-toast-success" id="flashToast" role="alert">
            <div class="kc-toast-icon">✓</div>
            <div class="kc-toast-body">
                <div class="kc-toast-title">@Html.Raw(flash)</div>
            </div>
            <button type="button" class="kc-toast-close" aria-label="Закрыть"
                    onclick="this.closest('.kc-toast').remove()">×</button>
        </div>
        <script data-soft-nav>setTimeout(() => document.getElementById('flashToast')?.remove(), 10000);</script>
    }
}
