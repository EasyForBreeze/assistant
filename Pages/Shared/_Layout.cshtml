@* Pages/Shared/_Layout.cshtml *@
<!doctype html>
<html lang="ru" class="h-full">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Assistant</title>
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <link rel="preload" href="~/favicon.ico" as="image" />

    <link rel="stylesheet" href="~/css/tailwind.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/kc.css" asp-append-version="true" />

    @RenderSection("Head", required: false)
</head>
<body class="min-h-screen bg-dark-pattern text-slate-100 relative overflow-x-hidden">
    <div class="app-glows" aria-hidden="true">
        <div class="app-glow app-glow--emerald"></div>
        <div class="app-glow app-glow--violet"></div>
        <div class="app-glow app-glow--bottom"></div>
    </div>

    <div class="relative z-10 flex min-h-screen flex-col">
        <header class="mx-auto w-full max-w-6xl px-4 md:px-8 pt-8 pb-6">
            <div class="header-panel">
                <div class="header-panel__glow"></div>
                <div class="header-panel__content">
                    <div class="flex flex-col gap-2">
                        <a asp-page="/Index" class="header-brand">
                            Assistant
                        </a>
                        <p class="header-subtitle">Единая панель для управления клиентами и правами доступа</p>
                    </div>

                    <div class="flex items-center gap-3">
                        <div class="text-right leading-tight hidden sm:block">
                            <div class="text-xs uppercase tracking-[0.28em] text-slate-400">Добро пожаловать</div>
                            <div class="text-base font-medium text-slate-100">@User.Identity!.Name</div>
                        </div>
                        <form method="post" asp-page="/Account/Logout" data-soft-ignore>
                            <button class="btn-ghost" type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                                    <polyline points="10 17 15 12 10 7" />
                                    <line x1="15" x2="3" y1="12" y2="12" />
                                </svg>
                                <span>Выйти</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </header>

        @{
            var currentPage = (ViewContext.RouteData.Values["page"] as string) ?? string.Empty;
            var isAdmin = User.IsInRole("assistant-admin");
        var linkBase = "flex items-center gap-3 rounded-xl px-3.5 py-2.5 text-sm font-medium transition";
        string LinkClass(string target)
            => string.Equals(currentPage, target, System.StringComparison.OrdinalIgnoreCase)
                ? $"{linkBase} nav-link--active"
                : $"{linkBase} nav-link";
        }
        <div class="flex-1 w-full">
            <div class="mx-auto w-full max-w-6xl px-4 md:px-8 pb-10" data-soft-root>
                <div class="flex flex-col gap-6 lg:flex-row">
                    @if (isAdmin)
                    {
                        <aside class="lg:w-72 lg:flex-shrink-0">
                            <div class="nav-panel md:sticky md:top-24">
                                <div class="nav-panel__header">
                                    <div class="nav-panel__pulse"></div>
                                    <div>
                                        <div class="nav-panel__caption">Администрирование</div>
                                        <div class="nav-panel__title">Управление доступом</div>
                                    </div>
                                </div>
                                <nav class="nav-panel__list" data-admin-nav>
                                    <a asp-page="/Clients/Search" class='@LinkClass("/Clients/Search")'>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8" />
                                            <path d="m21 21-4.3-4.3" />
                                        </svg>
                                <span>Поиск клиентов</span>
                            </a>
                            <a asp-page="/Admin/UserClients" class='@LinkClass("/Admin/UserClients")'>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M16 7a4 4 0 1 1-8 0 4 4 0 0 1 8 0Z" />
                                    <path d="M5.5 21a6.5 6.5 0 0 1 13 0" />
                                </svg>
                                <span>Доступ пользователей</span>
                            </a>
                            <a asp-page="/Admin/ServiceRoleExclusions" class='@LinkClass("/Admin/ServiceRoleExclusions")'>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="9" />
                                    <path d="M8 12h8" />
                                </svg>
                                <span>Список исключений</span>
                            </a>
                            <a asp-page="/Admin/Events" class='@LinkClass("/Admin/Events")'>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 7H3" />
                                            <path d="M21 11H3" />
                                            <path d="M15 15H3" />
                                            <path d="M9 19H3" />
                                            <path d="M17 2v3" />
                                            <path d="M7 2v3" />
                                            <rect width="18" height="18" x="3" y="4" rx="2" />
                                        </svg>
                                        <span>События</span>
                                    </a>
                                </nav>
                            </div>
                        </aside>
                    }
                    <main id="app" class="flex-1">
                        @RenderBody()
                    </main>
                </div>
            </div>
        </div>
    </div>
    <div id="toastsHost">
        @RenderSection("Toasts", required: false)
    </div>
    <div id="pageScripts">
        @RenderSection("Scripts", required: false)
    </div>
    <script type="module" src="~/js/soft-navigation.js" asp-append-version="true"></script>
</body>
</html>
