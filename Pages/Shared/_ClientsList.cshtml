@model Assistant.Pages.ClientsPageModel

@{
    var currentPage = (ViewContext.RouteData.Values["page"] as string) ?? string.Empty;
    var returnUrl = string.IsNullOrEmpty(currentPage)
        ? null
        : Url.Page(currentPage, new { q = Model.Q, pageNumber = Model.PageNumber });
}

@if (!Model.Clients.Any() && Model.ShowEmptyMessage)
{
    <div class="empty-state">
        <div class="empty-state__title">Нет клиентов</div>
        <div class="empty-state__subtitle">Попробуйте другой поиск или создайте нового клиента.</div>
    </div>
}
else if (Model.Clients.Any())
{
    <div class="clients-grid">
        @foreach (var c in Model.Clients)
        {
            var envList = Model.Envs(c.Realm).ToList();
            var displayName = c.DisplayName;
            var subtitle = string.Equals(displayName, c.ClientId, StringComparison.OrdinalIgnoreCase)
                ? $"Realm: {c.Realm}"
                : displayName;

            <a asp-page="/Clients/Details" asp-route-realm="@c.Realm" asp-route-clientId="@c.ClientId"
               asp-route-returnUrl="@returnUrl"
               class="client-card"
               data-search="@($"{c.ClientId} {c.Realm} {displayName}")">
                <div class="client-card__glow"></div>
                <div class="client-card__body">
                    <div class="client-card__top">
                        <div class="client-card__id">@c.ClientId</div>
                        <span class="status-pill @(c.Enabled ? "status-pill--enabled" : "status-pill--disabled")">
                            @(c.Enabled ? "Enabled" : "Disabled")
                        </span>
                    </div>

                    <div class="client-card__subtitle">@subtitle</div>

                    @if (envList.Any())
                    {
                        <div class="client-card__envs">
                            @foreach (var e in envList)
                            {
                                <span class="kc-chip">@e</span>
                            }
                        </div>
                    }
                </div>
            </a>
        }
    </div>

    @if (Model.TotalPages > 1)
    {
        <div class="clients-pagination">
            <nav>
                @if (Model.HasPreviousPage)
                {
                    <a asp-page="@currentPage" asp-route-q="@Model.Q" asp-route-pageNumber="@(Model.PageNumber - 1)" class="btn-subtle">Previous</a>
                }
                <span>Page @Model.PageNumber of @Model.TotalPages</span>
                @if (Model.HasNextPage)
                {
                    <a asp-page="@currentPage" asp-route-q="@Model.Q" asp-route-pageNumber="@(Model.PageNumber + 1)" class="btn-subtle">Next</a>
                }
            </nav>
        </div>
    }
}
